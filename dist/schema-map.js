'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _pgFormat = require('pg-format');

var _pgFormat2 = _interopRequireDefault(_pgFormat);

var _wellknown = require('wellknown');

var _wellknown2 = _interopRequireDefault(_wellknown);

var _fulcrumDesktopPlugin = require('fulcrum-desktop-plugin');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class SchemaMap {
  // * force 2d
  // * remove duplicate vertices
  static geomFromGeoJSON(geojsonGeometry) {
    if (geojsonGeometry == null) {
      return null;
    }

    return `ST_RemoveRepeatedPoints(ST_Force2D(ST_GeomFromText(${(0, _pgFormat2.default)('%L', _wellknown2.default.stringify(geojsonGeometry))}, 4326)))`;
  }

  // * force to multi
  // * force 2d
  // * remove duplicate vertices
  static multiGeomFromGeoJSON(geojsonGeometry) {
    if (geojsonGeometry == null) {
      return null;
    }

    return `ST_RemoveRepeatedPoints(ST_Force2D(ST_Multi(ST_GeomFromText(${(0, _pgFormat2.default)('%L', _wellknown2.default.stringify(geojsonGeometry))}, 4326))))`;
  }

  static geometry(latitude, longitude) {
    return { raw: this.geomFromGeoJSON({ type: 'Point', coordinates: [+longitude, +latitude] }) };
  }

  static trackGeometry(trackJSON) {
    if (trackJSON) {
      const track = new _fulcrumDesktopPlugin.core.Track('video', trackJSON);

      const geoJSON = track.toGeoJSONMultiLineString();

      if (geoJSON && geoJSON.geometry && geoJSON.geometry.coordinates.length && geoJSON.geometry.coordinates[0].length > 1) {
        return { raw: this.multiGeomFromGeoJSON(geoJSON) };
      }
    }

    return null;
  }

  static jsonValue(value) {
    return value != null ? JSON.stringify(value) : null;
  }

  static photo(row) {
    const hasLocation = row._latitude != null && row._longitude != null;

    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      access_key: row.id,
      record_id: row._recordRowID,
      record_resource_id: row._recordID,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      exif: this.jsonValue(row._exif),
      file_size: row._fileSize,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      file: row._filePath,
      content_type: row._contentType,
      is_uploaded: row._isUploaded,
      is_stored: row._isStored,
      is_processed: row._isProcessed,
      geometry: hasLocation ? this.geometry(row._latitude, row._longitude) : null,
      latitude: hasLocation ? row._latitude : null,
      longitude: hasLocation ? row._longitude : null,
      altitude: row._altitude,
      direction: row._direction,
      accuracy: row._accuracy,
      width: row._width,
      height: row._height,
      make: row._make,
      model: row._model,
      software: row._software,
      date_time: row._dateTime
    };
  }

  static video(row) {
    return {
      row_id: row._rowID,
      row_resource_id: row.id,
      access_key: row.id,
      record_id: row._recordRowID,
      record_resource_id: row._recordID,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      metadata: this.jsonValue(row._metadata),
      has_track: row._hasTrack,
      track: this.jsonValue(row._trackJSON),
      file_size: row._fileSize,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      file: row._filePath,
      content_type: row._contentType,
      is_uploaded: row._isUploaded,
      is_stored: row._isStored,
      is_processed: row._isProcessed,
      geometry: this.trackGeometry(row._trackJSON),
      width: row._width,
      height: row._height,
      duration: row._duration,
      bit_rate: row._bitRate
    };
  }

  static audio(row) {
    return {
      row_id: row._rowID,
      row_resource_id: row.id,
      access_key: row.id,
      record_id: row._recordRowID,
      record_resource_id: row._recordID,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      metadata: this.jsonValue(row._metadata),
      has_track: row._hasTrack,
      track: this.jsonValue(row._trackJSON),
      file_size: row._fileSize,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      file: row._filePath,
      content_type: row._contentType,
      is_uploaded: row._isUploaded,
      is_stored: row._isStored,
      is_processed: row._isProcessed,
      geometry: this.trackGeometry(row._trackJSON),
      duration: row._duration,
      bit_rate: row._bitRate
    };
  }

  static changeset(row) {
    const geometry = this.geomFromGeoJSON(row.boundingBoxAsGeoJSON);

    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      metadata: this.jsonValue(row._metadata),
      closed_at: row._closedAt,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      closed_by_id: row._closedByRowID,
      closed_by_resource_id: row._closedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      min_lat: row._minLat,
      max_lat: row._maxLat,
      min_lon: row._minLon,
      max_lon: row._maxLon,
      number_of_changes: row._numberOfChanges,
      number_of_creates: row._numberOfCreates,
      number_of_updates: row._numberOfUpdated,
      number_of_deletes: row._numberOfDeletes,
      metadata_index_text: row._metadataIndexText,
      metadata_index: { raw: `to_tsvector(${(0, _pgFormat2.default)('%L', row._metadataIndexText)})` },
      bounding_box: geometry ? { raw: this.geomFromGeoJSON(row.boundingBoxAsGeoJSON) } : null
    };
  }

  static choiceList(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      version: row._version,
      items: this.jsonValue(row._choicesJSON),
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }

  static classificationSet(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      version: row._version,
      items: this.jsonValue(row._itemsJSON),
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }

  static form(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      version: row._version,
      elements: this.jsonValue(row._elements),
      status: row._status,
      status_field: this.jsonValue(row._statusFieldJSON),
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt,
      auto_assign: row._autoAssign,
      title_field_keys: this.jsonValue(row._titleFieldKeys),
      hidden_on_dashboard: row._hiddenOnDashboard,
      geometry_types: this.jsonValue(row._geometryTypes),
      geometry_required: row._geometryRequired,
      script: row._script,
      image: row._image,
      projects_enabled: !!row._projectEnabled,
      assignment_enabled: !!row._assignmentEnabled
    };
  }

  static project(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }

  static role(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt,
      is_system: row._isSystem,
      is_default: row._isDefault,
      can_manage_subscription: row.canManageSubscription,
      can_update_organization: row.canUpdateOrganization,
      can_manage_members: row.canManageMembers,
      can_manage_roles: row.canManageRoles,
      can_manage_apps: row.canManageApps,
      can_manage_projects: row.canManageProjects,
      can_manage_choice_lists: row.canManageChoiceLists,
      can_manage_classification_sets: row.canManageClassificationSets,
      can_create_records: row.canCreateRecords,
      can_update_records: row.canUpdateRecords,
      can_delete_records: row.canDeleteRecords,
      can_change_status: row.canChangeStatus,
      can_change_project: row.canChangeProject,
      can_assign_records: row.canAssignRecords,
      can_import_records: row.canImportRecords,
      can_export_records: row.canExportRecords,
      can_run_reports: row.canRunReports
    };
  }

  static membership(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      user_resource_id: row._userID,
      first_name: row._firstName,
      last_name: row._lastName,
      name: (row._firstName || '') + ' ' + (row._lastName || ''),
      email: row._email,
      role_id: row._roleRowID,
      role_resource_id: row._roleID,
      status: row.status,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }
}
exports.default = SchemaMap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NjaGVtYS1tYXAuanMiXSwibmFtZXMiOlsiU2NoZW1hTWFwIiwiZ2VvbUZyb21HZW9KU09OIiwiZ2VvanNvbkdlb21ldHJ5Iiwic3RyaW5naWZ5IiwibXVsdGlHZW9tRnJvbUdlb0pTT04iLCJnZW9tZXRyeSIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwicmF3IiwidHlwZSIsImNvb3JkaW5hdGVzIiwidHJhY2tHZW9tZXRyeSIsInRyYWNrSlNPTiIsInRyYWNrIiwiVHJhY2siLCJnZW9KU09OIiwidG9HZW9KU09OTXVsdGlMaW5lU3RyaW5nIiwibGVuZ3RoIiwianNvblZhbHVlIiwidmFsdWUiLCJKU09OIiwicGhvdG8iLCJyb3ciLCJoYXNMb2NhdGlvbiIsIl9sYXRpdHVkZSIsIl9sb25naXR1ZGUiLCJyb3dfaWQiLCJyb3dJRCIsInJvd19yZXNvdXJjZV9pZCIsImlkIiwiYWNjZXNzX2tleSIsInJlY29yZF9pZCIsIl9yZWNvcmRSb3dJRCIsInJlY29yZF9yZXNvdXJjZV9pZCIsIl9yZWNvcmRJRCIsImZvcm1faWQiLCJfZm9ybVJvd0lEIiwiZm9ybV9yZXNvdXJjZV9pZCIsIl9mb3JtSUQiLCJleGlmIiwiX2V4aWYiLCJmaWxlX3NpemUiLCJfZmlsZVNpemUiLCJjcmVhdGVkX2J5X2lkIiwiX2NyZWF0ZWRCeVJvd0lEIiwiY3JlYXRlZF9ieV9yZXNvdXJjZV9pZCIsIl9jcmVhdGVkQnlJRCIsInVwZGF0ZWRfYnlfaWQiLCJfdXBkYXRlZEJ5Um93SUQiLCJ1cGRhdGVkX2J5X3Jlc291cmNlX2lkIiwiX3VwZGF0ZWRCeUlEIiwiY3JlYXRlZF9hdCIsIl9jcmVhdGVkQXQiLCJ1cGRhdGVkX2F0IiwiX3VwZGF0ZWRBdCIsImZpbGUiLCJfZmlsZVBhdGgiLCJjb250ZW50X3R5cGUiLCJfY29udGVudFR5cGUiLCJpc191cGxvYWRlZCIsIl9pc1VwbG9hZGVkIiwiaXNfc3RvcmVkIiwiX2lzU3RvcmVkIiwiaXNfcHJvY2Vzc2VkIiwiX2lzUHJvY2Vzc2VkIiwiYWx0aXR1ZGUiLCJfYWx0aXR1ZGUiLCJkaXJlY3Rpb24iLCJfZGlyZWN0aW9uIiwiYWNjdXJhY3kiLCJfYWNjdXJhY3kiLCJ3aWR0aCIsIl93aWR0aCIsImhlaWdodCIsIl9oZWlnaHQiLCJtYWtlIiwiX21ha2UiLCJtb2RlbCIsIl9tb2RlbCIsInNvZnR3YXJlIiwiX3NvZnR3YXJlIiwiZGF0ZV90aW1lIiwiX2RhdGVUaW1lIiwidmlkZW8iLCJfcm93SUQiLCJtZXRhZGF0YSIsIl9tZXRhZGF0YSIsImhhc190cmFjayIsIl9oYXNUcmFjayIsIl90cmFja0pTT04iLCJkdXJhdGlvbiIsIl9kdXJhdGlvbiIsImJpdF9yYXRlIiwiX2JpdFJhdGUiLCJhdWRpbyIsImNoYW5nZXNldCIsImJvdW5kaW5nQm94QXNHZW9KU09OIiwiY2xvc2VkX2F0IiwiX2Nsb3NlZEF0IiwiY2xvc2VkX2J5X2lkIiwiX2Nsb3NlZEJ5Um93SUQiLCJjbG9zZWRfYnlfcmVzb3VyY2VfaWQiLCJfY2xvc2VkQnlJRCIsIm1pbl9sYXQiLCJfbWluTGF0IiwibWF4X2xhdCIsIl9tYXhMYXQiLCJtaW5fbG9uIiwiX21pbkxvbiIsIm1heF9sb24iLCJfbWF4TG9uIiwibnVtYmVyX29mX2NoYW5nZXMiLCJfbnVtYmVyT2ZDaGFuZ2VzIiwibnVtYmVyX29mX2NyZWF0ZXMiLCJfbnVtYmVyT2ZDcmVhdGVzIiwibnVtYmVyX29mX3VwZGF0ZXMiLCJfbnVtYmVyT2ZVcGRhdGVkIiwibnVtYmVyX29mX2RlbGV0ZXMiLCJfbnVtYmVyT2ZEZWxldGVzIiwibWV0YWRhdGFfaW5kZXhfdGV4dCIsIl9tZXRhZGF0YUluZGV4VGV4dCIsIm1ldGFkYXRhX2luZGV4IiwiYm91bmRpbmdfYm94IiwiY2hvaWNlTGlzdCIsIm5hbWUiLCJfbmFtZSIsImRlc2NyaXB0aW9uIiwiX2Rlc2NyaXB0aW9uIiwidmVyc2lvbiIsIl92ZXJzaW9uIiwiaXRlbXMiLCJfY2hvaWNlc0pTT04iLCJkZWxldGVkX2F0IiwiX2RlbGV0ZWRBdCIsImNsYXNzaWZpY2F0aW9uU2V0IiwiX2l0ZW1zSlNPTiIsImZvcm0iLCJlbGVtZW50cyIsIl9lbGVtZW50cyIsInN0YXR1cyIsIl9zdGF0dXMiLCJzdGF0dXNfZmllbGQiLCJfc3RhdHVzRmllbGRKU09OIiwiYXV0b19hc3NpZ24iLCJfYXV0b0Fzc2lnbiIsInRpdGxlX2ZpZWxkX2tleXMiLCJfdGl0bGVGaWVsZEtleXMiLCJoaWRkZW5fb25fZGFzaGJvYXJkIiwiX2hpZGRlbk9uRGFzaGJvYXJkIiwiZ2VvbWV0cnlfdHlwZXMiLCJfZ2VvbWV0cnlUeXBlcyIsImdlb21ldHJ5X3JlcXVpcmVkIiwiX2dlb21ldHJ5UmVxdWlyZWQiLCJzY3JpcHQiLCJfc2NyaXB0IiwiaW1hZ2UiLCJfaW1hZ2UiLCJwcm9qZWN0c19lbmFibGVkIiwiX3Byb2plY3RFbmFibGVkIiwiYXNzaWdubWVudF9lbmFibGVkIiwiX2Fzc2lnbm1lbnRFbmFibGVkIiwicHJvamVjdCIsInJvbGUiLCJpc19zeXN0ZW0iLCJfaXNTeXN0ZW0iLCJpc19kZWZhdWx0IiwiX2lzRGVmYXVsdCIsImNhbl9tYW5hZ2Vfc3Vic2NyaXB0aW9uIiwiY2FuTWFuYWdlU3Vic2NyaXB0aW9uIiwiY2FuX3VwZGF0ZV9vcmdhbml6YXRpb24iLCJjYW5VcGRhdGVPcmdhbml6YXRpb24iLCJjYW5fbWFuYWdlX21lbWJlcnMiLCJjYW5NYW5hZ2VNZW1iZXJzIiwiY2FuX21hbmFnZV9yb2xlcyIsImNhbk1hbmFnZVJvbGVzIiwiY2FuX21hbmFnZV9hcHBzIiwiY2FuTWFuYWdlQXBwcyIsImNhbl9tYW5hZ2VfcHJvamVjdHMiLCJjYW5NYW5hZ2VQcm9qZWN0cyIsImNhbl9tYW5hZ2VfY2hvaWNlX2xpc3RzIiwiY2FuTWFuYWdlQ2hvaWNlTGlzdHMiLCJjYW5fbWFuYWdlX2NsYXNzaWZpY2F0aW9uX3NldHMiLCJjYW5NYW5hZ2VDbGFzc2lmaWNhdGlvblNldHMiLCJjYW5fY3JlYXRlX3JlY29yZHMiLCJjYW5DcmVhdGVSZWNvcmRzIiwiY2FuX3VwZGF0ZV9yZWNvcmRzIiwiY2FuVXBkYXRlUmVjb3JkcyIsImNhbl9kZWxldGVfcmVjb3JkcyIsImNhbkRlbGV0ZVJlY29yZHMiLCJjYW5fY2hhbmdlX3N0YXR1cyIsImNhbkNoYW5nZVN0YXR1cyIsImNhbl9jaGFuZ2VfcHJvamVjdCIsImNhbkNoYW5nZVByb2plY3QiLCJjYW5fYXNzaWduX3JlY29yZHMiLCJjYW5Bc3NpZ25SZWNvcmRzIiwiY2FuX2ltcG9ydF9yZWNvcmRzIiwiY2FuSW1wb3J0UmVjb3JkcyIsImNhbl9leHBvcnRfcmVjb3JkcyIsImNhbkV4cG9ydFJlY29yZHMiLCJjYW5fcnVuX3JlcG9ydHMiLCJjYW5SdW5SZXBvcnRzIiwibWVtYmVyc2hpcCIsInVzZXJfcmVzb3VyY2VfaWQiLCJfdXNlcklEIiwiZmlyc3RfbmFtZSIsIl9maXJzdE5hbWUiLCJsYXN0X25hbWUiLCJfbGFzdE5hbWUiLCJlbWFpbCIsIl9lbWFpbCIsInJvbGVfaWQiLCJfcm9sZVJvd0lEIiwicm9sZV9yZXNvdXJjZV9pZCIsIl9yb2xlSUQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVlLE1BQU1BLFNBQU4sQ0FBZ0I7QUFDN0I7QUFDQTtBQUNBLFNBQU9DLGVBQVAsQ0FBdUJDLGVBQXZCLEVBQXdDO0FBQ3RDLFFBQUlBLG1CQUFtQixJQUF2QixFQUE2QjtBQUMzQixhQUFPLElBQVA7QUFDRDs7QUFFRCxXQUFRLHNEQUFzRCx3QkFBUyxJQUFULEVBQWUsb0JBQUlDLFNBQUosQ0FBY0QsZUFBZCxDQUFmLENBQWdELFdBQTlHO0FBQ0Q7O0FBRUQ7QUFDQTtBQUNBO0FBQ0EsU0FBT0Usb0JBQVAsQ0FBNEJGLGVBQTVCLEVBQTZDO0FBQzNDLFFBQUlBLG1CQUFtQixJQUF2QixFQUE2QjtBQUMzQixhQUFPLElBQVA7QUFDRDs7QUFFRCxXQUFRLCtEQUErRCx3QkFBUyxJQUFULEVBQWUsb0JBQUlDLFNBQUosQ0FBY0QsZUFBZCxDQUFmLENBQWdELFlBQXZIO0FBQ0Q7O0FBRUQsU0FBT0csUUFBUCxDQUFnQkMsUUFBaEIsRUFB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ZXNDb250ZW50IjpbImltcG9ydCBwZ2Zvcm1hdCBmcm9tICdwZy1mb3JtYXQnO1xuaW1wb3J0IHdrdCBmcm9tICd3ZWxsa25vd24nO1xuaW1wb3J0IHsgY29yZSB9IGZyb20gJ2Z1bGNydW0nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2hlbWFNYXAge1xuICAvLyAqIGZvcmNlIDJkXG4gIC8vICogcmVtb3ZlIGR1cGxpY2F0ZSB2ZXJ0aWNlc1xuICBzdGF0aWMgZ2VvbUZyb21HZW9KU09OKGdlb2pzb25HZW9tZXRyeSkge1xuICAgIGlmIChnZW9qc29uR2VvbWV0cnkgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGBTVF9SZW1vdmVSZXBlYXRlZFBvaW50cyhTVF9Gb3JjZTJEKFNUX0dlb21Gcm9tVGV4dCgkeyBwZ2Zvcm1hdCgnJUwnLCB3a3Quc3RyaW5naWZ5KGdlb2pzb25HZW9tZXRyeSkpIH0sIDQzMjYpKSlgO1xuICB9XG5cbiAgLy8gKiBmb3JjZSB0byBtdWx0aVxuICAvLyAqIGZvcmNlIDJkXG4gIC8vICogcmVtb3ZlIGR1cGxpY2F0ZSB2ZXJ0aWNlc1xuICBzdGF0aWMgbXVsdGlHZW9tRnJvbUdlb0pTT04oZ2VvanNvbkdlb21ldHJ5KSB7XG4gICAgaWYgKGdlb2pzb25HZW9tZXRyeSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gYFNUX1JlbW92ZVJlcGVhdGVkUG9pbnRzKFNUX0ZvcmNlMkQoU1RfTXVsdGkoU1RfR2VvbUZyb21UZXh0KCR7IHBnZm9ybWF0KCclTCcsIHdrdC5zdHJpbmdpZnkoZ2VvanNvbkdlb21ldHJ5KSkgfSwgNDMyNikpKSlgO1xuICB9XG5cbiAgc3RhdGljIGdlb21ldHJ5KGxhdGl0dWRlLCBsb25naXR1ZGUpIHtcbiAgICByZXR1cm4geyByYXc6IHRoaXMuZ2VvbUZyb21HZW9KU09OKHt0eXBlOiAnUG9pbnQnLCBjb29yZGluYXRlczogWyArbG9uZ2l0dWRlLCArbGF0aXR1ZGUgXX0pIH07XG4gIH1cblxuICBzdGF0aWMgdHJhY2tHZW9tZXRyeSh0cmFja0pTT04pIHtcbiAgICBpZiAodHJhY2tKU09OKSB7XG4gICAgICBjb25zdCB0cmFjayA9IG5ldyBjb3JlLlRyYWNrKCd2aWRlbycsIHRyYWNrSlNPTik7XG5cbiAgICAgIGNvbnN0IGdlb0pTT04gPSB0cmFjay50b0dlb0pTT05NdWx0aUxpbmVTdHJpbmcoKTtcblxuICAgICAgaWYgKGdlb0pTT04gJiYgZ2VvSlNPTi5nZW9tZXRyeSAmJiBnZW9KU09OLmdlb21ldHJ5LmNvb3JkaW5hdGVzLmxlbmd0aCAmJiBnZW9KU09OLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcmV0dXJuIHsgcmF3OiB0aGlzLm11bHRpR2VvbUZyb21HZW9KU09OKGdlb0pTT04pIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBzdGF0aWMganNvblZhbHVlKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9IG51bGwgPyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgOiBudWxsO1xuICB9XG5cbiAgc3RhdGljIHBob3RvKHJvdykge1xuICAgIGNvbnN0IGhhc0xvY2F0aW9uID0gcm93Ll9sYXRpdHVkZSAhPSBudWxsICYmIHJvdy5fbG9uZ2l0dWRlICE9IG51bGw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cucm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIGFjY2Vzc19rZXk6IHJvdy5pZCxcbiAgICAgIHJlY29yZF9pZDogcm93Ll9yZWNvcmRSb3dJRCxcbiAgICAgIHJlY29yZF9yZXNvdXJjZV9pZDogcm93Ll9yZWNvcmRJRCxcbiAgICAgIGZvcm1faWQ6IHJvdy5fZm9ybVJvd0lELFxuICAgICAgZm9ybV9yZXNvdXJjZV9pZDogcm93Ll9mb3JtSUQsXG4gICAgICBleGlmOiB0aGlzLmpzb25WYWx1ZShyb3cuX2V4aWYpLFxuICAgICAgZmlsZV9zaXplOiByb3cuX2ZpbGVTaXplLFxuICAgICAgY3JlYXRlZF9ieV9pZDogcm93Ll9jcmVhdGVkQnlSb3dJRCxcbiAgICAgIGNyZWF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fY3JlYXRlZEJ5SUQsXG4gICAgICB1cGRhdGVkX2J5X2lkOiByb3cuX3VwZGF0ZWRCeVJvd0lELFxuICAgICAgdXBkYXRlZF9ieV9yZXNvdXJjZV9pZDogcm93Ll91cGRhdGVkQnlJRCxcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBmaWxlOiByb3cuX2ZpbGVQYXRoLFxuICAgICAgY29udGVudF90eXBlOiByb3cuX2NvbnRlbnRUeXBlLFxuICAgICAgaXNfdXBsb2FkZWQ6IHJvdy5faXNVcGxvYWRlZCxcbiAgICAgIGlzX3N0b3JlZDogcm93Ll9pc1N0b3JlZCxcbiAgICAgIGlzX3Byb2Nlc3NlZDogcm93Ll9pc1Byb2Nlc3NlZCxcbiAgICAgIGdlb21ldHJ5OiBoYXNMb2NhdGlvbiA/IHRoaXMuZ2VvbWV0cnkocm93Ll9sYXRpdHVkZSwgcm93Ll9sb25naXR1ZGUpIDogbnVsbCxcbiAgICAgIGxhdGl0dWRlOiBoYXNMb2NhdGlvbiA/IHJvdy5fbGF0aXR1ZGUgOiBudWxsLFxuICAgICAgbG9uZ2l0dWRlOiBoYXNMb2NhdGlvbiA/IHJvdy5fbG9uZ2l0dWRlIDogbnVsbCxcbiAgICAgIGFsdGl0dWRlOiByb3cuX2FsdGl0dWRlLFxuICAgICAgZGlyZWN0aW9uOiByb3cuX2RpcmVjdGlvbixcbiAgICAgIGFjY3VyYWN5OiByb3cuX2FjY3VyYWN5LFxuICAgICAgd2lkdGg6IHJvdy5fd2lkdGgsXG4gICAgICBoZWlnaHQ6IHJvdy5faGVpZ2h0LFxuICAgICAgbWFrZTogcm93Ll9tYWtlLFxuICAgICAgbW9kZWw6IHJvdy5fbW9kZWwsXG4gICAgICBzb2Z0d2FyZTogcm93Ll9zb2Z0d2FyZSxcbiAgICAgIGRhdGVfdGltZTogcm93Ll9kYXRlVGltZVxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgdmlkZW8ocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93Ll9yb3dJRCxcbiAgICAgIHJvd19yZXNvdXJjZV9pZDogcm93LmlkLFxuICAgICAgYWNjZXNzX2tleTogcm93LmlkLFxuICAgICAgcmVjb3JkX2lkOiByb3cuX3JlY29yZFJvd0lELFxuICAgICAgcmVjb3JkX3Jlc291cmNlX2lkOiByb3cuX3JlY29yZElELFxuICAgICAgZm9ybV9pZDogcm93Ll9mb3JtUm93SUQsXG4gICAgICBmb3JtX3Jlc291cmNlX2lkOiByb3cuX2Zvcm1JRCxcbiAgICAgIG1ldGFkYXRhOiB0aGlzLmpzb25WYWx1ZShyb3cuX21ldGFkYXRhKSxcbiAgICAgIGhhc190cmFjazogcm93Ll9oYXNUcmFjayxcbiAgICAgIHRyYWNrOiB0aGlzLmpzb25WYWx1ZShyb3cuX3RyYWNrSlNPTiksXG4gICAgICBmaWxlX3NpemU6IHJvdy5fZmlsZVNpemUsXG4gICAgICBjcmVhdGVkX2J5X2lkOiByb3cuX2NyZWF0ZWRCeVJvd0lELFxuICAgICAgY3JlYXRlZF9ieV9yZXNvdXJjZV9pZDogcm93Ll9jcmVhdGVkQnlJRCxcbiAgICAgIHVwZGF0ZWRfYnlfaWQ6IHJvdy5fdXBkYXRlZEJ5Um93SUQsXG4gICAgICB1cGRhdGVkX2J5X3Jlc291cmNlX2lkOiByb3cuX3VwZGF0ZWRCeUlELFxuICAgICAgY3JlYXRlZF9hdDogcm93Ll9jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkX2F0OiByb3cuX3VwZGF0ZWRBdCxcbiAgICAgIGZpbGU6IHJvdy5fZmlsZVBhdGgsXG4gICAgICBjb250ZW50X3R5cGU6IHJvdy5fY29udGVudFR5cGUsXG4gICAgICBpc191cGxvYWRlZDogcm93Ll9pc1VwbG9hZGVkLFxuICAgICAgaXNfc3RvcmVkOiByb3cuX2lzU3RvcmVkLFxuICAgICAgaXNfcHJvY2Vzc2VkOiByb3cuX2lzUHJvY2Vzc2VkLFxuICAgICAgZ2VvbWV0cnk6IHRoaXMudHJhY2tHZW9tZXRyeShyb3cuX3RyYWNrSlNPTiksXG4gICAgICB3aWR0aDogcm93Ll93aWR0aCxcbiAgICAgIGhlaWdodDogcm93Ll9oZWlnaHQsXG4gICAgICBkdXJhdGlvbjogcm93Ll9kdXJhdGlvbixcbiAgICAgIGJpdF9yYXRlOiByb3cuX2JpdFJhdGVcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGF1ZGlvKHJvdykge1xuICAgIHJldHVybiB7XG4gICAgICByb3dfaWQ6IHJvdy5fcm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIGFjY2Vzc19rZXk6IHJvdy5pZCxcbiAgICAgIHJlY29yZF9pZDogcm93Ll9yZWNvcmRSb3dJRCxcbiAgICAgIHJlY29yZF9yZXNvdXJjZV9pZDogcm93Ll9yZWNvcmRJRCxcbiAgICAgIGZvcm1faWQ6IHJvdy5fZm9ybVJvd0lELFxuICAgICAgZm9ybV9yZXNvdXJjZV9pZDogcm93Ll9mb3JtSUQsXG4gICAgICBtZXRhZGF0YTogdGhpcy5qc29uVmFsdWUocm93Ll9tZXRhZGF0YSksXG4gICAgICBoYXNfdHJhY2s6IHJvdy5faGFzVHJhY2ssXG4gICAgICB0cmFjazogdGhpcy5qc29uVmFsdWUocm93Ll90cmFja0pTT04pLFxuICAgICAgZmlsZV9zaXplOiByb3cuX2ZpbGVTaXplLFxuICAgICAgY3JlYXRlZF9ieV9pZDogcm93Ll9jcmVhdGVkQnlSb3dJRCxcbiAgICAgIGNyZWF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fY3JlYXRlZEJ5SUQsXG4gICAgICB1cGRhdGVkX2J5X2lkOiByb3cuX3VwZGF0ZWRCeVJvd0lELFxuICAgICAgdXBkYXRlZF9ieV9yZXNvdXJjZV9pZDogcm93Ll91cGRhdGVkQnlJRCxcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBmaWxlOiByb3cuX2ZpbGVQYXRoLFxuICAgICAgY29udGVudF90eXBlOiByb3cuX2NvbnRlbnRUeXBlLFxuICAgICAgaXNfdXBsb2FkZWQ6IHJvdy5faXNVcGxvYWRlZCxcbiAgICAgIGlzX3N0b3JlZDogcm93Ll9pc1N0b3JlZCxcbiAgICAgIGlzX3Byb2Nlc3NlZDogcm93Ll9pc1Byb2Nlc3NlZCxcbiAgICAgIGdlb21ldHJ5OiB0aGlzLnRyYWNrR2VvbWV0cnkocm93Ll90cmFja0pTT04pLFxuICAgICAgZHVyYXRpb246IHJvdy5fZHVyYXRpb24sXG4gICAgICBiaXRfcmF0ZTogcm93Ll9iaXRSYXRlXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBjaGFuZ2VzZXQocm93KSB7XG4gICAgY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21Gcm9tR2VvSlNPTihyb3cuYm91bmRpbmdCb3hBc0dlb0pTT04pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBmb3JtX2lkOiByb3cuX2Zvcm1Sb3dJRCxcbiAgICAgIGZvcm1fcmVzb3VyY2VfaWQ6IHJvdy5fZm9ybUlELFxuICAgICAgbWV0YWRhdGE6IHRoaXMuanNvblZhbHVlKHJvdy5fbWV0YWRhdGEpLFxuICAgICAgY2xvc2VkX2F0OiByb3cuX2Nsb3NlZEF0LFxuICAgICAgY3JlYXRlZF9ieV9pZDogcm93Ll9jcmVhdGVkQnlSb3dJRCxcbiAgICAgIGNyZWF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fY3JlYXRlZEJ5SUQsXG4gICAgICB1cGRhdGVkX2J5X2lkOiByb3cuX3VwZGF0ZWRCeVJvd0lELFxuICAgICAgdXBkYXRlZF9ieV9yZXNvdXJjZV9pZDogcm93Ll91cGRhdGVkQnlJRCxcbiAgICAgIGNsb3NlZF9ieV9pZDogcm93Ll9jbG9zZWRCeVJvd0lELFxuICAgICAgY2xvc2VkX2J5X3Jlc291cmNlX2lkOiByb3cuX2Nsb3NlZEJ5SUQsXG4gICAgICBjcmVhdGVkX2F0OiByb3cuX2NyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IHJvdy5fdXBkYXRlZEF0LFxuICAgICAgbWluX2xhdDogcm93Ll9taW5MYXQsXG4gICAgICBtYXhfbGF0OiByb3cuX21heExhdCxcbiAgICAgIG1pbl9sb246IHJvdy5fbWluTG9uLFxuICAgICAgbWF4X2xvbjogcm93Ll9tYXhMb24sXG4gICAgICBudW1iZXJfb2ZfY2hhbmdlczogcm93Ll9udW1iZXJPZkNoYW5nZXMsXG4gICAgICBudW1iZXJfb2ZfY3JlYXRlczogcm93Ll9udW1iZXJPZkNyZWF0ZXMsXG4gICAgICBudW1iZXJfb2ZfdXBkYXRlczogcm93Ll9udW1iZXJPZlVwZGF0ZWQsXG4gICAgICBudW1iZXJfb2ZfZGVsZXRlczogcm93Ll9udW1iZXJPZkRlbGV0ZXMsXG4gICAgICBtZXRhZGF0YV9pbmRleF90ZXh0OiByb3cuX21ldGFkYXRhSW5kZXhUZXh0LFxuICAgICAgbWV0YWRhdGFfaW5kZXg6IHtyYXc6IGB0b190c3ZlY3RvcigkeyBwZ2Zvcm1hdCgnJUwnLCByb3cuX21ldGFkYXRhSW5kZXhUZXh0KSB9KWB9LFxuICAgICAgYm91bmRpbmdfYm94OiBnZW9tZXRyeSA/IHtyYXc6IHRoaXMuZ2VvbUZyb21HZW9KU09OKHJvdy5ib3VuZGluZ0JveEFzR2VvSlNPTil9IDogbnVsbFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgY2hvaWNlTGlzdChyb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cucm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIG5hbWU6IHJvdy5fbmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiByb3cuX2Rlc2NyaXB0aW9uLFxuICAgICAgdmVyc2lvbjogcm93Ll92ZXJzaW9uLFxuICAgICAgaXRlbXM6IHRoaXMuanNvblZhbHVlKHJvdy5fY2hvaWNlc0pTT04pLFxuICAgICAgY3JlYXRlZF9hdDogcm93Ll9jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkX2F0OiByb3cuX3VwZGF0ZWRBdCxcbiAgICAgIGRlbGV0ZWRfYXQ6IHJvdy5fZGVsZXRlZEF0XG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBjbGFzc2lmaWNhdGlvblNldChyb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cucm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIG5hbWU6IHJvdy5fbmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiByb3cuX2Rlc2NyaXB0aW9uLFxuICAgICAgdmVyc2lvbjogcm93Ll92ZXJzaW9uLFxuICAgICAgaXRlbXM6IHRoaXMuanNvblZhbHVlKHJvdy5faXRlbXNKU09OKSxcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBkZWxldGVkX2F0OiByb3cuX2RlbGV0ZWRBdFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgZm9ybShyb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cucm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIG5hbWU6IHJvdy5fbmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiByb3cuX2Rlc2NyaXB0aW9uLFxuICAgICAgdmVyc2lvbjogcm93Ll92ZXJzaW9uLFxuICAgICAgZWxlbWVudHM6IHRoaXMuanNvblZhbHVlKHJvdy5fZWxlbWVudHMpLFxuICAgICAgc3RhdHVzOiByb3cuX3N0YXR1cyxcbiAgICAgIHN0YXR1c19maWVsZDogdGhpcy5qc29uVmFsdWUocm93Ll9zdGF0dXNGaWVsZEpTT04pLFxuICAgICAgY3JlYXRlZF9hdDogcm93Ll9jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkX2F0OiByb3cuX3VwZGF0ZWRBdCxcbiAgICAgIGRlbGV0ZWRfYXQ6IHJvdy5fZGVsZXRlZEF0LFxuICAgICAgYXV0b19hc3NpZ246IHJvdy5fYXV0b0Fzc2lnbixcbiAgICAgIHRpdGxlX2ZpZWxkX2tleXM6IHRoaXMuanNvblZhbHVlKHJvdy5fdGl0bGVGaWVsZEtleXMpLFxuICAgICAgaGlkZGVuX29uX2Rhc2hib2FyZDogcm93Ll9oaWRkZW5PbkRhc2hib2FyZCxcbiAgICAgIGdlb21ldHJ5X3R5cGVzOiB0aGlzLmpzb25WYWx1ZShyb3cuX2dlb21ldHJ5VHlwZXMpLFxuICAgICAgZ2VvbWV0cnlfcmVxdWlyZWQ6IHJvdy5fZ2VvbWV0cnlSZXF1aXJlZCxcbiAgICAgIHNjcmlwdDogcm93Ll9zY3JpcHQsXG4gICAgICBpbWFnZTogcm93Ll9pbWFnZSxcbiAgICAgIHByb2plY3RzX2VuYWJsZWQ6ICEhcm93Ll9wcm9qZWN0RW5hYmxlZCxcbiAgICAgIGFzc2lnbm1lbnRfZW5hYmxlZDogISFyb3cuX2Fzc2lnbm1lbnRFbmFibGVkXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBwcm9qZWN0KHJvdykge1xuICAgIHJldHVybiB7XG4gICAgICByb3dfaWQ6IHJvdy5yb3dJRCxcbiAgICAgIHJvd19yZXNvdXJjZV9pZDogcm93LmlkLFxuICAgICAgbmFtZTogcm93Ll9uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHJvdy5fZGVzY3JpcHRpb24sXG4gICAgICBjcmVhdGVkX2F0OiByb3cuX2NyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IHJvdy5fdXBkYXRlZEF0LFxuICAgICAgZGVsZXRlZF9hdDogcm93Ll9kZWxldGVkQXRcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIHJvbGUocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cuX25hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcm93Ll9kZXNjcmlwdGlvbixcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBkZWxldGVkX2F0OiByb3cuX2RlbGV0ZWRBdCxcbiAgICAgIGlzX3N5c3RlbTogcm93Ll9pc1N5c3RlbSxcbiAgICAgIGlzX2RlZmF1bHQ6IHJvdy5faXNEZWZhdWx0LFxuICAgICAgY2FuX21hbmFnZV9zdWJzY3JpcHRpb246IHJvdy5jYW5NYW5hZ2VTdWJzY3JpcHRpb24sXG4gICAgICBjYW5fdXBkYXRlX29yZ2FuaXphdGlvbjogcm93LmNhblVwZGF0ZU9yZ2FuaXphdGlvbixcbiAgICAgIGNhbl9tYW5hZ2VfbWVtYmVyczogcm93LmNhbk1hbmFnZU1lbWJlcnMsXG4gICAgICBjYW5fbWFuYWdlX3JvbGVzOiByb3cuY2FuTWFuYWdlUm9sZXMsXG4gICAgICBjYW5fbWFuYWdlX2FwcHM6IHJvdy5jYW5NYW5hZ2VBcHBzLFxuICAgICAgY2FuX21hbmFnZV9wcm9qZWN0czogcm93LmNhbk1hbmFnZVByb2plY3RzLFxuICAgICAgY2FuX21hbmFnZV9jaG9pY2VfbGlzdHM6IHJvdy5jYW5NYW5hZ2VDaG9pY2VMaXN0cyxcbiAgICAgIGNhbl9tYW5hZ2VfY2xhc3NpZmljYXRpb25fc2V0czogcm93LmNhbk1hbmFnZUNsYXNzaWZpY2F0aW9uU2V0cyxcbiAgICAgIGNhbl9jcmVhdGVfcmVjb3Jkczogcm93LmNhbkNyZWF0ZVJlY29yZHMsXG4gICAgICBjYW5fdXBkYXRlX3JlY29yZHM6IHJvdy5jYW5VcGRhdGVSZWNvcmRzLFxuICAgICAgY2FuX2RlbGV0ZV9yZWNvcmRzOiByb3cuY2FuRGVsZXRlUmVjb3JkcyxcbiAgICAgIGNhbl9jaGFuZ2Vfc3RhdHVzOiByb3cuY2FuQ2hhbmdlU3RhdHVzLFxuICAgICAgY2FuX2NoYW5nZV9wcm9qZWN0OiByb3cuY2FuQ2hhbmdlUHJvamVjdCxcbiAgICAgIGNhbl9hc3NpZ25fcmVjb3Jkczogcm93LmNhbkFzc2lnblJlY29yZHMsXG4gICAgICBjYW5faW1wb3J0X3JlY29yZHM6IHJvdy5jYW5JbXBvcnRSZWNvcmRzLFxuICAgICAgY2FuX2V4cG9ydF9yZWNvcmRzOiByb3cuY2FuRXhwb3J0UmVjb3JkcyxcbiAgICAgIGNhbl9ydW5fcmVwb3J0czogcm93LmNhblJ1blJlcG9ydHNcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIG1lbWJlcnNoaXAocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICB1c2VyX3Jlc291cmNlX2lkOiByb3cuX3VzZXJJRCxcbiAgICAgIGZpcnN0X25hbWU6IHJvdy5fZmlyc3ROYW1lLFxuICAgICAgbGFzdF9uYW1lOiByb3cuX2xhc3ROYW1lLFxuICAgICAgbmFtZTogKHJvdy5fZmlyc3ROYW1lIHx8ICcnKSArICcgJyArIChyb3cuX2xhc3ROYW1lIHx8ICcnKSxcbiAgICAgIGVtYWlsOiByb3cuX2VtYWlsLFxuICAgICAgcm9sZV9pZDogcm93Ll9yb2xlUm93SUQsXG4gICAgICByb2xlX3Jlc291cmNlX2lkOiByb3cuX3JvbGVJRCxcbiAgICAgIHN0YXR1czogcm93LnN0YXR1cyxcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBkZWxldGVkX2F0OiByb3cuX2RlbGV0ZWRBdFxuICAgIH07XG4gIH1cbn1cbiJdfQ==