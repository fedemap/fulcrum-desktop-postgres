'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _pgFormat = require('pg-format');

var _pgFormat2 = _interopRequireDefault(_pgFormat);

var _wellknown = require('wellknown');

var _wellknown2 = _interopRequireDefault(_wellknown);

var _fulcrumDesktopPlugin = require('fulcrum-desktop-plugin');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class SchemaMap {
  // * force 2d
  // * remove duplicate vertices
  static geomFromGeoJSON(geojsonGeometry) {
    if (geojsonGeometry == null) {
      return null;
    }

    return `ST_RemoveRepeatedPoints(ST_Force2D(ST_GeomFromText(${(0, _pgFormat2.default)('%L', _wellknown2.default.stringify(geojsonGeometry))}, 4326)))`;
  }

  // * force to multi
  // * force 2d
  // * remove duplicate vertices
  static multiGeomFromGeoJSON(geojsonGeometry) {
    if (geojsonGeometry == null) {
      return null;
    }

    return `ST_RemoveRepeatedPoints(ST_Force2D(ST_Multi(ST_GeomFromText(${(0, _pgFormat2.default)('%L', _wellknown2.default.stringify(geojsonGeometry))}, 4326))))`;
  }

  static geometry(latitude, longitude) {
    return { raw: this.geomFromGeoJSON({ type: 'Point', coordinates: [+longitude, +latitude] }) };
  }

  static trackGeometry(trackJSON) {
    if (trackJSON) {
      const track = new _fulcrumDesktopPlugin.core.Track('video', trackJSON);

      const geoJSON = track.toGeoJSONMultiLineString();

      if (geoJSON && geoJSON.geometry && geoJSON.geometry.coordinates.length && geoJSON.geometry.coordinates[0].length > 1) {
        return { raw: this.multiGeomFromGeoJSON(geoJSON) };
      }
    }

    return null;
  }

  static jsonValue(value) {
    return value != null ? JSON.stringify(value) : null;
  }

  static photo(row) {
    const hasLocation = row._latitude != null && row._longitude != null;

    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      access_key: row.id,
      record_id: row._recordRowID,
      record_resource_id: row._recordID,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      exif: this.jsonValue(row._exif),
      file_size: row._fileSize,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      file: row._filePath,
      content_type: row._contentType,
      is_uploaded: row._isUploaded,
      is_stored: row._isStored,
      is_processed: row._isProcessed,
      geometry: hasLocation ? this.geometry(row._latitude, row._longitude) : null,
      latitude: hasLocation ? row._latitude : null,
      longitude: hasLocation ? row._longitude : null,
      altitude: row._altitude,
      direction: row._direction,
      accuracy: row._accuracy,
      width: row._width,
      height: row._height,
      make: row._make,
      model: row._model,
      software: row._software,
      date_time: row._dateTime
    };
  }

  static video(row) {
    return {
      row_id: row._rowID,
      row_resource_id: row.id,
      access_key: row.id,
      record_id: row._recordRowID,
      record_resource_id: row._recordID,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      metadata: this.jsonValue(row._metadata),
      has_track: row._hasTrack,
      track: this.jsonValue(row._trackJSON),
      file_size: row._fileSize,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      file: row._filePath,
      content_type: row._contentType,
      is_uploaded: row._isUploaded,
      is_stored: row._isStored,
      is_processed: row._isProcessed,
      geometry: this.trackGeometry(row._trackJSON),
      width: row._width,
      height: row._height,
      duration: row._duration,
      bit_rate: row._bitRate
    };
  }

  static audio(row) {
    return {
      row_id: row._rowID,
      row_resource_id: row.id,
      access_key: row.id,
      record_id: row._recordRowID,
      record_resource_id: row._recordID,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      metadata: this.jsonValue(row._metadata),
      has_track: row._hasTrack,
      track: this.jsonValue(row._trackJSON),
      file_size: row._fileSize,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      file: row._filePath,
      content_type: row._contentType,
      is_uploaded: row._isUploaded,
      is_stored: row._isStored,
      is_processed: row._isProcessed,
      geometry: this.trackGeometry(row._trackJSON),
      duration: row._duration,
      bit_rate: row._bitRate
    };
  }

  static changeset(row) {
    const geometry = this.geomFromGeoJSON(row.boundingBoxAsGeoJSON);

    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      form_id: row._formRowID,
      form_resource_id: row._formID,
      metadata: this.jsonValue(row._metadata),
      closed_at: row._closedAt,
      created_by_id: row._createdByRowID,
      created_by_resource_id: row._createdByID,
      updated_by_id: row._updatedByRowID,
      updated_by_resource_id: row._updatedByID,
      closed_by_id: row._closedByRowID,
      closed_by_resource_id: row._closedByID,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      min_lat: row._minLat,
      max_lat: row._maxLat,
      min_lon: row._minLon,
      max_lon: row._maxLon,
      number_of_changes: row._numberOfChanges,
      number_of_creates: row._numberOfCreates,
      number_of_updates: row._numberOfUpdated,
      number_of_deletes: row._numberOfDeletes,
      metadata_index_text: row._metadataIndexText,
      metadata_index: { raw: `to_tsvector(${(0, _pgFormat2.default)('%L', row._metadataIndexText)})` },
      bounding_box: geometry ? { raw: this.geomFromGeoJSON(row.boundingBoxAsGeoJSON) } : null
    };
  }

  static choiceList(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      version: row._version,
      items: this.jsonValue(row._choicesJSON),
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }

  static classificationSet(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      version: row._version,
      items: this.jsonValue(row._itemsJSON),
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }

  static form(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      version: row._version,
      elements: this.jsonValue(row._elementsJSON),
      status: row._status,
      status_field: this.jsonValue(row._statusFieldJSON),
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt,
      auto_assign: row._autoAssign,
      title_field_keys: this.jsonValue(row._titleFieldKeys),
      hidden_on_dashboard: row._hiddenOnDashboard,
      geometry_types: this.jsonValue(row._geometryTypes),
      geometry_required: row._geometryRequired,
      script: row._script,
      image: row._image,
      projects_enabled: !!row._projectEnabled,
      assignment_enabled: !!row._assignmentEnabled
    };
  }

  static project(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }

  static role(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      name: row._name,
      description: row._description,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt,
      is_system: row._isSystem,
      is_default: row._isDefault,
      can_manage_subscription: row.canManageSubscription,
      can_update_organization: row.canUpdateOrganization,
      can_manage_members: row.canManageMembers,
      can_manage_roles: row.canManageRoles,
      can_manage_apps: row.canManageApps,
      can_manage_projects: row.canManageProjects,
      can_manage_choice_lists: row.canManageChoiceLists,
      can_manage_classification_sets: row.canManageClassificationSets,
      can_create_records: row.canCreateRecords,
      can_update_records: row.canUpdateRecords,
      can_delete_records: row.canDeleteRecords,
      can_change_status: row.canChangeStatus,
      can_change_project: row.canChangeProject,
      can_assign_records: row.canAssignRecords,
      can_import_records: row.canImportRecords,
      can_export_records: row.canExportRecords,
      can_run_reports: row.canRunReports
    };
  }

  static membership(row) {
    return {
      row_id: row.rowID,
      row_resource_id: row.id,
      user_resource_id: row._userID,
      first_name: row._firstName,
      last_name: row._lastName,
      name: (row._firstName || '') + ' ' + (row._lastName || ''),
      email: row._email,
      role_id: row._roleRowID,
      role_resource_id: row._roleID,
      status: row.status,
      created_at: row._createdAt,
      updated_at: row._updatedAt,
      deleted_at: row._deletedAt
    };
  }
}
exports.default = SchemaMap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NjaGVtYS1tYXAuanMiXSwibmFtZXMiOlsiU2NoZW1hTWFwIiwiZ2VvbUZyb21HZW9KU09OIiwiZ2VvanNvbkdlb21ldHJ5Iiwic3RyaW5naWZ5IiwibXVsdGlHZW9tRnJvbUdlb0pTT04iLCJnZW9tZXRyeSIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwicmF3IiwidHlwZSIsImNvb3JkaW5hdGVzIiwidHJhY2tHZW9tZXRyeSIsInRyYWNrSlNPTiIsInRyYWNrIiwiVHJhY2siLCJnZW9KU09OIiwidG9HZW9KU09OTXVsdGlMaW5lU3RyaW5nIiwibGVuZ3RoIiwianNvblZhbHVlIiwidmFsdWUiLCJKU09OIiwicGhvdG8iLCJyb3ciLCJoYXNMb2NhdGlvbiIsIl9sYXRpdHVkZSIsIl9sb25naXR1ZGUiLCJyb3dfaWQiLCJyb3dJRCIsInJvd19yZXNvdXJjZV9pZCIsImlkIiwiYWNjZXNzX2tleSIsInJlY29yZF9pZCIsIl9yZWNvcmRSb3dJRCIsInJlY29yZF9yZXNvdXJjZV9pZCIsIl9yZWNvcmRJRCIsImZvcm1faWQiLCJfZm9ybVJvd0lEIiwiZm9ybV9yZXNvdXJjZV9pZCIsIl9mb3JtSUQiLCJleGlmIiwiX2V4aWYiLCJmaWxlX3NpemUiLCJfZmlsZVNpemUiLCJjcmVhdGVkX2J5X2lkIiwiX2NyZWF0ZWRCeVJvd0lEIiwiY3JlYXRlZF9ieV9yZXNvdXJjZV9pZCIsIl9jcmVhdGVkQnlJRCIsInVwZGF0ZWRfYnlfaWQiLCJfdXBkYXRlZEJ5Um93SUQiLCJ1cGRhdGVkX2J5X3Jlc291cmNlX2lkIiwiX3VwZGF0ZWRCeUlEIiwiY3JlYXRlZF9hdCIsIl9jcmVhdGVkQXQiLCJ1cGRhdGVkX2F0IiwiX3VwZGF0ZWRBdCIsImZpbGUiLCJfZmlsZVBhdGgiLCJjb250ZW50X3R5cGUiLCJfY29udGVudFR5cGUiLCJpc191cGxvYWRlZCIsIl9pc1VwbG9hZGVkIiwiaXNfc3RvcmVkIiwiX2lzU3RvcmVkIiwiaXNfcHJvY2Vzc2VkIiwiX2lzUHJvY2Vzc2VkIiwiYWx0aXR1ZGUiLCJfYWx0aXR1ZGUiLCJkaXJlY3Rpb24iLCJfZGlyZWN0aW9uIiwiYWNjdXJhY3kiLCJfYWNjdXJhY3kiLCJ3aWR0aCIsIl93aWR0aCIsImhlaWdodCIsIl9oZWlnaHQiLCJtYWtlIiwiX21ha2UiLCJtb2RlbCIsIl9tb2RlbCIsInNvZnR3YXJlIiwiX3NvZnR3YXJlIiwiZGF0ZV90aW1lIiwiX2RhdGVUaW1lIiwidmlkZW8iLCJfcm93SUQiLCJtZXRhZGF0YSIsIl9tZXRhZGF0YSIsImhhc190cmFjayIsIl9oYXNUcmFjayIsIl90cmFja0pTT04iLCJkdXJhdGlvbiIsIl9kdXJhdGlvbiIsImJpdF9yYXRlIiwiX2JpdFJhdGUiLCJhdWRpbyIsImNoYW5nZXNldCIsImJvdW5kaW5nQm94QXNHZW9KU09OIiwiY2xvc2VkX2F0IiwiX2Nsb3NlZEF0IiwiY2xvc2VkX2J5X2lkIiwiX2Nsb3NlZEJ5Um93SUQiLCJjbG9zZWRfYnlfcmVzb3VyY2VfaWQiLCJfY2xvc2VkQnlJRCIsIm1pbl9sYXQiLCJfbWluTGF0IiwibWF4X2xhdCIsIl9tYXhMYXQiLCJtaW5fbG9uIiwiX21pbkxvbiIsIm1heF9sb24iLCJfbWF4TG9uIiwibnVtYmVyX29mX2NoYW5nZXMiLCJfbnVtYmVyT2ZDaGFuZ2VzIiwibnVtYmVyX29mX2NyZWF0ZXMiLCJfbnVtYmVyT2ZDcmVhdGVzIiwibnVtYmVyX29mX3VwZGF0ZXMiLCJfbnVtYmVyT2ZVcGRhdGVkIiwibnVtYmVyX29mX2RlbGV0ZXMiLCJfbnVtYmVyT2ZEZWxldGVzIiwibWV0YWRhdGFfaW5kZXhfdGV4dCIsIl9tZXRhZGF0YUluZGV4VGV4dCIsIm1ldGFkYXRhX2luZGV4IiwiYm91bmRpbmdfYm94IiwiY2hvaWNlTGlzdCIsIm5hbWUiLCJfbmFtZSIsImRlc2NyaXB0aW9uIiwiX2Rlc2NyaXB0aW9uIiwidmVyc2lvbiIsIl92ZXJzaW9uIiwiaXRlbXMiLCJfY2hvaWNlc0pTT04iLCJkZWxldGVkX2F0IiwiX2RlbGV0ZWRBdCIsImNsYXNzaWZpY2F0aW9uU2V0IiwiX2l0ZW1zSlNPTiIsImZvcm0iLCJlbGVtZW50cyIsIl9lbGVtZW50c0pTT04iLCJzdGF0dXMiLCJfc3RhdHVzIiwic3RhdHVzX2ZpZWxkIiwiX3N0YXR1c0ZpZWxkSlNPTiIsImF1dG9fYXNzaWduIiwiX2F1dG9Bc3NpZ24iLCJ0aXRsZV9maWVsZF9rZXlzIiwiX3RpdGxlRmllbGRLZXlzIiwiaGlkZGVuX29uX2Rhc2hib2FyZCIsIl9oaWRkZW5PbkRhc2hib2FyZCIsImdlb21ldHJ5X3R5cGVzIiwiX2dlb21ldHJ5VHlwZXMiLCJnZW9tZXRyeV9yZXF1aXJlZCIsIl9nZW9tZXRyeVJlcXVpcmVkIiwic2NyaXB0IiwiX3NjcmlwdCIsImltYWdlIiwiX2ltYWdlIiwicHJvamVjdHNfZW5hYmxlZCIsIl9wcm9qZWN0RW5hYmxlZCIsImFzc2lnbm1lbnRfZW5hYmxlZCIsIl9hc3NpZ25tZW50RW5hYmxlZCIsInByb2plY3QiLCJyb2xlIiwiaXNfc3lzdGVtIiwiX2lzU3lzdGVtIiwiaXNfZGVmYXVsdCIsIl9pc0RlZmF1bHQiLCJjYW5fbWFuYWdlX3N1YnNjcmlwdGlvbiIsImNhbk1hbmFnZVN1YnNjcmlwdGlvbiIsImNhbl91cGRhdGVfb3JnYW5pemF0aW9uIiwiY2FuVXBkYXRlT3JnYW5pemF0aW9uIiwiY2FuX21hbmFnZV9tZW1iZXJzIiwiY2FuTWFuYWdlTWVtYmVycyIsImNhbl9tYW5hZ2Vfcm9sZXMiLCJjYW5NYW5hZ2VSb2xlcyIsImNhbl9tYW5hZ2VfYXBwcyIsImNhbk1hbmFnZUFwcHMiLCJjYW5fbWFuYWdlX3Byb2plY3RzIiwiY2FuTWFuYWdlUHJvamVjdHMiLCJjYW5fbWFuYWdlX2Nob2ljZV9saXN0cyIsImNhbk1hbmFnZUNob2ljZUxpc3RzIiwiY2FuX21hbmFnZV9jbGFzc2lmaWNhdGlvbl9zZXRzIiwiY2FuTWFuYWdlQ2xhc3NpZmljYXRpb25TZXRzIiwiY2FuX2NyZWF0ZV9yZWNvcmRzIiwiY2FuQ3JlYXRlUmVjb3JkcyIsImNhbl91cGRhdGVfcmVjb3JkcyIsImNhblVwZGF0ZVJlY29yZHMiLCJjYW5fZGVsZXRlX3JlY29yZHMiLCJjYW5EZWxldGVSZWNvcmRzIiwiY2FuX2NoYW5nZV9zdGF0dXMiLCJjYW5DaGFuZ2VTdGF0dXMiLCJjYW5fY2hhbmdlX3Byb2plY3QiLCJjYW5DaGFuZ2VQcm9qZWN0IiwiY2FuX2Fzc2lnbl9yZWNvcmRzIiwiY2FuQXNzaWduUmVjb3JkcyIsImNhbl9pbXBvcnRfcmVjb3JkcyIsImNhbkltcG9ydFJlY29yZHMiLCJjYW5fZXhwb3J0X3JlY29yZHMiLCJjYW5FeHBvcnRSZWNvcmRzIiwiY2FuX3J1bl9yZXBvcnRzIiwiY2FuUnVuUmVwb3J0cyIsIm1lbWJlcnNoaXAiLCJ1c2VyX3Jlc291cmNlX2lkIiwiX3VzZXJJRCIsImZpcnN0X25hbWUiLCJfZmlyc3ROYW1lIiwibGFzdF9uYW1lIiwiX2xhc3ROYW1lIiwiZW1haWwiLCJfZW1haWwiLCJyb2xlX2lkIiwiX3JvbGVSb3dJRCIsInJvbGVfcmVzb3VyY2VfaWQiLCJfcm9sZUlEIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFZSxNQUFNQSxTQUFOLENBQWdCO0FBQzdCO0FBQ0E7QUFDQSxTQUFPQyxlQUFQLENBQXVCQyxlQUF2QixFQUF3QztBQUN0QyxRQUFJQSxtQkFBbUIsSUFBdkIsRUFBNkI7QUFDM0IsYUFBTyxJQUFQO0FBQ0Q7O0FBRUQsV0FBUSxzREFBc0Qsd0JBQVMsSUFBVCxFQUFlLG9CQUFJQyxTQUFKLENBQWNELGVBQWQsQ0FBZixDQUFnRCxXQUE5RztBQUNEOztBQUVEO0FBQ0E7QUFDQTtBQUNBLFNBQU9FLG9CQUFQLENBQTRCRixlQUE1QixFQUE2QztBQUMzQyxRQUFJQSxtQkFBbUIsSUFBdkIsRUFBNkI7QUFDM0IsYUFBTyxJQUFQO0FBQ0Q7O0FBRUQsV0FBUSwrREFBK0Qsd0JBQVMsSUFBVCxFQUFlLG9CQUFJQyxTQUFKLENBQWNELGVBQWQsQ0FBZixDQUFnRCxZQUF2SDtBQUNEOztBQUVELFNBQU9HLFFBQVAsQ0FBZ0JDLFFBQWhC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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGdmb3JtYXQgZnJvbSAncGctZm9ybWF0JztcbmltcG9ydCB3a3QgZnJvbSAnd2VsbGtub3duJztcbmltcG9ydCB7IGNvcmUgfSBmcm9tICdmdWxjcnVtJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NoZW1hTWFwIHtcbiAgLy8gKiBmb3JjZSAyZFxuICAvLyAqIHJlbW92ZSBkdXBsaWNhdGUgdmVydGljZXNcbiAgc3RhdGljIGdlb21Gcm9tR2VvSlNPTihnZW9qc29uR2VvbWV0cnkpIHtcbiAgICBpZiAoZ2VvanNvbkdlb21ldHJ5ID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBgU1RfUmVtb3ZlUmVwZWF0ZWRQb2ludHMoU1RfRm9yY2UyRChTVF9HZW9tRnJvbVRleHQoJHsgcGdmb3JtYXQoJyVMJywgd2t0LnN0cmluZ2lmeShnZW9qc29uR2VvbWV0cnkpKSB9LCA0MzI2KSkpYDtcbiAgfVxuXG4gIC8vICogZm9yY2UgdG8gbXVsdGlcbiAgLy8gKiBmb3JjZSAyZFxuICAvLyAqIHJlbW92ZSBkdXBsaWNhdGUgdmVydGljZXNcbiAgc3RhdGljIG11bHRpR2VvbUZyb21HZW9KU09OKGdlb2pzb25HZW9tZXRyeSkge1xuICAgIGlmIChnZW9qc29uR2VvbWV0cnkgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGBTVF9SZW1vdmVSZXBlYXRlZFBvaW50cyhTVF9Gb3JjZTJEKFNUX011bHRpKFNUX0dlb21Gcm9tVGV4dCgkeyBwZ2Zvcm1hdCgnJUwnLCB3a3Quc3RyaW5naWZ5KGdlb2pzb25HZW9tZXRyeSkpIH0sIDQzMjYpKSkpYDtcbiAgfVxuXG4gIHN0YXRpYyBnZW9tZXRyeShsYXRpdHVkZSwgbG9uZ2l0dWRlKSB7XG4gICAgcmV0dXJuIHsgcmF3OiB0aGlzLmdlb21Gcm9tR2VvSlNPTih7dHlwZTogJ1BvaW50JywgY29vcmRpbmF0ZXM6IFsgK2xvbmdpdHVkZSwgK2xhdGl0dWRlIF19KSB9O1xuICB9XG5cbiAgc3RhdGljIHRyYWNrR2VvbWV0cnkodHJhY2tKU09OKSB7XG4gICAgaWYgKHRyYWNrSlNPTikge1xuICAgICAgY29uc3QgdHJhY2sgPSBuZXcgY29yZS5UcmFjaygndmlkZW8nLCB0cmFja0pTT04pO1xuXG4gICAgICBjb25zdCBnZW9KU09OID0gdHJhY2sudG9HZW9KU09OTXVsdGlMaW5lU3RyaW5nKCk7XG5cbiAgICAgIGlmIChnZW9KU09OICYmIGdlb0pTT04uZ2VvbWV0cnkgJiYgZ2VvSlNPTi5nZW9tZXRyeS5jb29yZGluYXRlcy5sZW5ndGggJiYgZ2VvSlNPTi5nZW9tZXRyeS5jb29yZGluYXRlc1swXS5sZW5ndGggPiAxKSB7XG4gICAgICAgIHJldHVybiB7IHJhdzogdGhpcy5tdWx0aUdlb21Gcm9tR2VvSlNPTihnZW9KU09OKSB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc3RhdGljIGpzb25WYWx1ZSh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSAhPSBudWxsID8gSlNPTi5zdHJpbmdpZnkodmFsdWUpIDogbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBwaG90byhyb3cpIHtcbiAgICBjb25zdCBoYXNMb2NhdGlvbiA9IHJvdy5fbGF0aXR1ZGUgIT0gbnVsbCAmJiByb3cuX2xvbmdpdHVkZSAhPSBudWxsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBhY2Nlc3Nfa2V5OiByb3cuaWQsXG4gICAgICByZWNvcmRfaWQ6IHJvdy5fcmVjb3JkUm93SUQsXG4gICAgICByZWNvcmRfcmVzb3VyY2VfaWQ6IHJvdy5fcmVjb3JkSUQsXG4gICAgICBmb3JtX2lkOiByb3cuX2Zvcm1Sb3dJRCxcbiAgICAgIGZvcm1fcmVzb3VyY2VfaWQ6IHJvdy5fZm9ybUlELFxuICAgICAgZXhpZjogdGhpcy5qc29uVmFsdWUocm93Ll9leGlmKSxcbiAgICAgIGZpbGVfc2l6ZTogcm93Ll9maWxlU2l6ZSxcbiAgICAgIGNyZWF0ZWRfYnlfaWQ6IHJvdy5fY3JlYXRlZEJ5Um93SUQsXG4gICAgICBjcmVhdGVkX2J5X3Jlc291cmNlX2lkOiByb3cuX2NyZWF0ZWRCeUlELFxuICAgICAgdXBkYXRlZF9ieV9pZDogcm93Ll91cGRhdGVkQnlSb3dJRCxcbiAgICAgIHVwZGF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fdXBkYXRlZEJ5SUQsXG4gICAgICBjcmVhdGVkX2F0OiByb3cuX2NyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IHJvdy5fdXBkYXRlZEF0LFxuICAgICAgZmlsZTogcm93Ll9maWxlUGF0aCxcbiAgICAgIGNvbnRlbnRfdHlwZTogcm93Ll9jb250ZW50VHlwZSxcbiAgICAgIGlzX3VwbG9hZGVkOiByb3cuX2lzVXBsb2FkZWQsXG4gICAgICBpc19zdG9yZWQ6IHJvdy5faXNTdG9yZWQsXG4gICAgICBpc19wcm9jZXNzZWQ6IHJvdy5faXNQcm9jZXNzZWQsXG4gICAgICBnZW9tZXRyeTogaGFzTG9jYXRpb24gPyB0aGlzLmdlb21ldHJ5KHJvdy5fbGF0aXR1ZGUsIHJvdy5fbG9uZ2l0dWRlKSA6IG51bGwsXG4gICAgICBsYXRpdHVkZTogaGFzTG9jYXRpb24gPyByb3cuX2xhdGl0dWRlIDogbnVsbCxcbiAgICAgIGxvbmdpdHVkZTogaGFzTG9jYXRpb24gPyByb3cuX2xvbmdpdHVkZSA6IG51bGwsXG4gICAgICBhbHRpdHVkZTogcm93Ll9hbHRpdHVkZSxcbiAgICAgIGRpcmVjdGlvbjogcm93Ll9kaXJlY3Rpb24sXG4gICAgICBhY2N1cmFjeTogcm93Ll9hY2N1cmFjeSxcbiAgICAgIHdpZHRoOiByb3cuX3dpZHRoLFxuICAgICAgaGVpZ2h0OiByb3cuX2hlaWdodCxcbiAgICAgIG1ha2U6IHJvdy5fbWFrZSxcbiAgICAgIG1vZGVsOiByb3cuX21vZGVsLFxuICAgICAgc29mdHdhcmU6IHJvdy5fc29mdHdhcmUsXG4gICAgICBkYXRlX3RpbWU6IHJvdy5fZGF0ZVRpbWVcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIHZpZGVvKHJvdykge1xuICAgIHJldHVybiB7XG4gICAgICByb3dfaWQ6IHJvdy5fcm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIGFjY2Vzc19rZXk6IHJvdy5pZCxcbiAgICAgIHJlY29yZF9pZDogcm93Ll9yZWNvcmRSb3dJRCxcbiAgICAgIHJlY29yZF9yZXNvdXJjZV9pZDogcm93Ll9yZWNvcmRJRCxcbiAgICAgIGZvcm1faWQ6IHJvdy5fZm9ybVJvd0lELFxuICAgICAgZm9ybV9yZXNvdXJjZV9pZDogcm93Ll9mb3JtSUQsXG4gICAgICBtZXRhZGF0YTogdGhpcy5qc29uVmFsdWUocm93Ll9tZXRhZGF0YSksXG4gICAgICBoYXNfdHJhY2s6IHJvdy5faGFzVHJhY2ssXG4gICAgICB0cmFjazogdGhpcy5qc29uVmFsdWUocm93Ll90cmFja0pTT04pLFxuICAgICAgZmlsZV9zaXplOiByb3cuX2ZpbGVTaXplLFxuICAgICAgY3JlYXRlZF9ieV9pZDogcm93Ll9jcmVhdGVkQnlSb3dJRCxcbiAgICAgIGNyZWF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fY3JlYXRlZEJ5SUQsXG4gICAgICB1cGRhdGVkX2J5X2lkOiByb3cuX3VwZGF0ZWRCeVJvd0lELFxuICAgICAgdXBkYXRlZF9ieV9yZXNvdXJjZV9pZDogcm93Ll91cGRhdGVkQnlJRCxcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBmaWxlOiByb3cuX2ZpbGVQYXRoLFxuICAgICAgY29udGVudF90eXBlOiByb3cuX2NvbnRlbnRUeXBlLFxuICAgICAgaXNfdXBsb2FkZWQ6IHJvdy5faXNVcGxvYWRlZCxcbiAgICAgIGlzX3N0b3JlZDogcm93Ll9pc1N0b3JlZCxcbiAgICAgIGlzX3Byb2Nlc3NlZDogcm93Ll9pc1Byb2Nlc3NlZCxcbiAgICAgIGdlb21ldHJ5OiB0aGlzLnRyYWNrR2VvbWV0cnkocm93Ll90cmFja0pTT04pLFxuICAgICAgd2lkdGg6IHJvdy5fd2lkdGgsXG4gICAgICBoZWlnaHQ6IHJvdy5faGVpZ2h0LFxuICAgICAgZHVyYXRpb246IHJvdy5fZHVyYXRpb24sXG4gICAgICBiaXRfcmF0ZTogcm93Ll9iaXRSYXRlXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBhdWRpbyhyb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cuX3Jvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBhY2Nlc3Nfa2V5OiByb3cuaWQsXG4gICAgICByZWNvcmRfaWQ6IHJvdy5fcmVjb3JkUm93SUQsXG4gICAgICByZWNvcmRfcmVzb3VyY2VfaWQ6IHJvdy5fcmVjb3JkSUQsXG4gICAgICBmb3JtX2lkOiByb3cuX2Zvcm1Sb3dJRCxcbiAgICAgIGZvcm1fcmVzb3VyY2VfaWQ6IHJvdy5fZm9ybUlELFxuICAgICAgbWV0YWRhdGE6IHRoaXMuanNvblZhbHVlKHJvdy5fbWV0YWRhdGEpLFxuICAgICAgaGFzX3RyYWNrOiByb3cuX2hhc1RyYWNrLFxuICAgICAgdHJhY2s6IHRoaXMuanNvblZhbHVlKHJvdy5fdHJhY2tKU09OKSxcbiAgICAgIGZpbGVfc2l6ZTogcm93Ll9maWxlU2l6ZSxcbiAgICAgIGNyZWF0ZWRfYnlfaWQ6IHJvdy5fY3JlYXRlZEJ5Um93SUQsXG4gICAgICBjcmVhdGVkX2J5X3Jlc291cmNlX2lkOiByb3cuX2NyZWF0ZWRCeUlELFxuICAgICAgdXBkYXRlZF9ieV9pZDogcm93Ll91cGRhdGVkQnlSb3dJRCxcbiAgICAgIHVwZGF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fdXBkYXRlZEJ5SUQsXG4gICAgICBjcmVhdGVkX2F0OiByb3cuX2NyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IHJvdy5fdXBkYXRlZEF0LFxuICAgICAgZmlsZTogcm93Ll9maWxlUGF0aCxcbiAgICAgIGNvbnRlbnRfdHlwZTogcm93Ll9jb250ZW50VHlwZSxcbiAgICAgIGlzX3VwbG9hZGVkOiByb3cuX2lzVXBsb2FkZWQsXG4gICAgICBpc19zdG9yZWQ6IHJvdy5faXNTdG9yZWQsXG4gICAgICBpc19wcm9jZXNzZWQ6IHJvdy5faXNQcm9jZXNzZWQsXG4gICAgICBnZW9tZXRyeTogdGhpcy50cmFja0dlb21ldHJ5KHJvdy5fdHJhY2tKU09OKSxcbiAgICAgIGR1cmF0aW9uOiByb3cuX2R1cmF0aW9uLFxuICAgICAgYml0X3JhdGU6IHJvdy5fYml0UmF0ZVxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgY2hhbmdlc2V0KHJvdykge1xuICAgIGNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tRnJvbUdlb0pTT04ocm93LmJvdW5kaW5nQm94QXNHZW9KU09OKTtcblxuICAgIHJldHVybiB7XG4gICAgICByb3dfaWQ6IHJvdy5yb3dJRCxcbiAgICAgIHJvd19yZXNvdXJjZV9pZDogcm93LmlkLFxuICAgICAgZm9ybV9pZDogcm93Ll9mb3JtUm93SUQsXG4gICAgICBmb3JtX3Jlc291cmNlX2lkOiByb3cuX2Zvcm1JRCxcbiAgICAgIG1ldGFkYXRhOiB0aGlzLmpzb25WYWx1ZShyb3cuX21ldGFkYXRhKSxcbiAgICAgIGNsb3NlZF9hdDogcm93Ll9jbG9zZWRBdCxcbiAgICAgIGNyZWF0ZWRfYnlfaWQ6IHJvdy5fY3JlYXRlZEJ5Um93SUQsXG4gICAgICBjcmVhdGVkX2J5X3Jlc291cmNlX2lkOiByb3cuX2NyZWF0ZWRCeUlELFxuICAgICAgdXBkYXRlZF9ieV9pZDogcm93Ll91cGRhdGVkQnlSb3dJRCxcbiAgICAgIHVwZGF0ZWRfYnlfcmVzb3VyY2VfaWQ6IHJvdy5fdXBkYXRlZEJ5SUQsXG4gICAgICBjbG9zZWRfYnlfaWQ6IHJvdy5fY2xvc2VkQnlSb3dJRCxcbiAgICAgIGNsb3NlZF9ieV9yZXNvdXJjZV9pZDogcm93Ll9jbG9zZWRCeUlELFxuICAgICAgY3JlYXRlZF9hdDogcm93Ll9jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkX2F0OiByb3cuX3VwZGF0ZWRBdCxcbiAgICAgIG1pbl9sYXQ6IHJvdy5fbWluTGF0LFxuICAgICAgbWF4X2xhdDogcm93Ll9tYXhMYXQsXG4gICAgICBtaW5fbG9uOiByb3cuX21pbkxvbixcbiAgICAgIG1heF9sb246IHJvdy5fbWF4TG9uLFxuICAgICAgbnVtYmVyX29mX2NoYW5nZXM6IHJvdy5fbnVtYmVyT2ZDaGFuZ2VzLFxuICAgICAgbnVtYmVyX29mX2NyZWF0ZXM6IHJvdy5fbnVtYmVyT2ZDcmVhdGVzLFxuICAgICAgbnVtYmVyX29mX3VwZGF0ZXM6IHJvdy5fbnVtYmVyT2ZVcGRhdGVkLFxuICAgICAgbnVtYmVyX29mX2RlbGV0ZXM6IHJvdy5fbnVtYmVyT2ZEZWxldGVzLFxuICAgICAgbWV0YWRhdGFfaW5kZXhfdGV4dDogcm93Ll9tZXRhZGF0YUluZGV4VGV4dCxcbiAgICAgIG1ldGFkYXRhX2luZGV4OiB7cmF3OiBgdG9fdHN2ZWN0b3IoJHsgcGdmb3JtYXQoJyVMJywgcm93Ll9tZXRhZGF0YUluZGV4VGV4dCkgfSlgfSxcbiAgICAgIGJvdW5kaW5nX2JveDogZ2VvbWV0cnkgPyB7cmF3OiB0aGlzLmdlb21Gcm9tR2VvSlNPTihyb3cuYm91bmRpbmdCb3hBc0dlb0pTT04pfSA6IG51bGxcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGNob2ljZUxpc3Qocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cuX25hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcm93Ll9kZXNjcmlwdGlvbixcbiAgICAgIHZlcnNpb246IHJvdy5fdmVyc2lvbixcbiAgICAgIGl0ZW1zOiB0aGlzLmpzb25WYWx1ZShyb3cuX2Nob2ljZXNKU09OKSxcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBkZWxldGVkX2F0OiByb3cuX2RlbGV0ZWRBdFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgY2xhc3NpZmljYXRpb25TZXQocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cuX25hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcm93Ll9kZXNjcmlwdGlvbixcbiAgICAgIHZlcnNpb246IHJvdy5fdmVyc2lvbixcbiAgICAgIGl0ZW1zOiB0aGlzLmpzb25WYWx1ZShyb3cuX2l0ZW1zSlNPTiksXG4gICAgICBjcmVhdGVkX2F0OiByb3cuX2NyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IHJvdy5fdXBkYXRlZEF0LFxuICAgICAgZGVsZXRlZF9hdDogcm93Ll9kZWxldGVkQXRcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGZvcm0ocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cuX25hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcm93Ll9kZXNjcmlwdGlvbixcbiAgICAgIHZlcnNpb246IHJvdy5fdmVyc2lvbixcbiAgICAgIGVsZW1lbnRzOiB0aGlzLmpzb25WYWx1ZShyb3cuX2VsZW1lbnRzSlNPTiksXG4gICAgICBzdGF0dXM6IHJvdy5fc3RhdHVzLFxuICAgICAgc3RhdHVzX2ZpZWxkOiB0aGlzLmpzb25WYWx1ZShyb3cuX3N0YXR1c0ZpZWxkSlNPTiksXG4gICAgICBjcmVhdGVkX2F0OiByb3cuX2NyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IHJvdy5fdXBkYXRlZEF0LFxuICAgICAgZGVsZXRlZF9hdDogcm93Ll9kZWxldGVkQXQsXG4gICAgICBhdXRvX2Fzc2lnbjogcm93Ll9hdXRvQXNzaWduLFxuICAgICAgdGl0bGVfZmllbGRfa2V5czogdGhpcy5qc29uVmFsdWUocm93Ll90aXRsZUZpZWxkS2V5cyksXG4gICAgICBoaWRkZW5fb25fZGFzaGJvYXJkOiByb3cuX2hpZGRlbk9uRGFzaGJvYXJkLFxuICAgICAgZ2VvbWV0cnlfdHlwZXM6IHRoaXMuanNvblZhbHVlKHJvdy5fZ2VvbWV0cnlUeXBlcyksXG4gICAgICBnZW9tZXRyeV9yZXF1aXJlZDogcm93Ll9nZW9tZXRyeVJlcXVpcmVkLFxuICAgICAgc2NyaXB0OiByb3cuX3NjcmlwdCxcbiAgICAgIGltYWdlOiByb3cuX2ltYWdlLFxuICAgICAgcHJvamVjdHNfZW5hYmxlZDogISFyb3cuX3Byb2plY3RFbmFibGVkLFxuICAgICAgYXNzaWdubWVudF9lbmFibGVkOiAhIXJvdy5fYXNzaWdubWVudEVuYWJsZWRcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIHByb2plY3Qocm93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd19pZDogcm93LnJvd0lELFxuICAgICAgcm93X3Jlc291cmNlX2lkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cuX25hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcm93Ll9kZXNjcmlwdGlvbixcbiAgICAgIGNyZWF0ZWRfYXQ6IHJvdy5fY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZF9hdDogcm93Ll91cGRhdGVkQXQsXG4gICAgICBkZWxldGVkX2F0OiByb3cuX2RlbGV0ZWRBdFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgcm9sZShyb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cucm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIG5hbWU6IHJvdy5fbmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiByb3cuX2Rlc2NyaXB0aW9uLFxuICAgICAgY3JlYXRlZF9hdDogcm93Ll9jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkX2F0OiByb3cuX3VwZGF0ZWRBdCxcbiAgICAgIGRlbGV0ZWRfYXQ6IHJvdy5fZGVsZXRlZEF0LFxuICAgICAgaXNfc3lzdGVtOiByb3cuX2lzU3lzdGVtLFxuICAgICAgaXNfZGVmYXVsdDogcm93Ll9pc0RlZmF1bHQsXG4gICAgICBjYW5fbWFuYWdlX3N1YnNjcmlwdGlvbjogcm93LmNhbk1hbmFnZVN1YnNjcmlwdGlvbixcbiAgICAgIGNhbl91cGRhdGVfb3JnYW5pemF0aW9uOiByb3cuY2FuVXBkYXRlT3JnYW5pemF0aW9uLFxuICAgICAgY2FuX21hbmFnZV9tZW1iZXJzOiByb3cuY2FuTWFuYWdlTWVtYmVycyxcbiAgICAgIGNhbl9tYW5hZ2Vfcm9sZXM6IHJvdy5jYW5NYW5hZ2VSb2xlcyxcbiAgICAgIGNhbl9tYW5hZ2VfYXBwczogcm93LmNhbk1hbmFnZUFwcHMsXG4gICAgICBjYW5fbWFuYWdlX3Byb2plY3RzOiByb3cuY2FuTWFuYWdlUHJvamVjdHMsXG4gICAgICBjYW5fbWFuYWdlX2Nob2ljZV9saXN0czogcm93LmNhbk1hbmFnZUNob2ljZUxpc3RzLFxuICAgICAgY2FuX21hbmFnZV9jbGFzc2lmaWNhdGlvbl9zZXRzOiByb3cuY2FuTWFuYWdlQ2xhc3NpZmljYXRpb25TZXRzLFxuICAgICAgY2FuX2NyZWF0ZV9yZWNvcmRzOiByb3cuY2FuQ3JlYXRlUmVjb3JkcyxcbiAgICAgIGNhbl91cGRhdGVfcmVjb3Jkczogcm93LmNhblVwZGF0ZVJlY29yZHMsXG4gICAgICBjYW5fZGVsZXRlX3JlY29yZHM6IHJvdy5jYW5EZWxldGVSZWNvcmRzLFxuICAgICAgY2FuX2NoYW5nZV9zdGF0dXM6IHJvdy5jYW5DaGFuZ2VTdGF0dXMsXG4gICAgICBjYW5fY2hhbmdlX3Byb2plY3Q6IHJvdy5jYW5DaGFuZ2VQcm9qZWN0LFxuICAgICAgY2FuX2Fzc2lnbl9yZWNvcmRzOiByb3cuY2FuQXNzaWduUmVjb3JkcyxcbiAgICAgIGNhbl9pbXBvcnRfcmVjb3Jkczogcm93LmNhbkltcG9ydFJlY29yZHMsXG4gICAgICBjYW5fZXhwb3J0X3JlY29yZHM6IHJvdy5jYW5FeHBvcnRSZWNvcmRzLFxuICAgICAgY2FuX3J1bl9yZXBvcnRzOiByb3cuY2FuUnVuUmVwb3J0c1xuICAgIH07XG4gIH1cblxuICBzdGF0aWMgbWVtYmVyc2hpcChyb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcm93X2lkOiByb3cucm93SUQsXG4gICAgICByb3dfcmVzb3VyY2VfaWQ6IHJvdy5pZCxcbiAgICAgIHVzZXJfcmVzb3VyY2VfaWQ6IHJvdy5fdXNlcklELFxuICAgICAgZmlyc3RfbmFtZTogcm93Ll9maXJzdE5hbWUsXG4gICAgICBsYXN0X25hbWU6IHJvdy5fbGFzdE5hbWUsXG4gICAgICBuYW1lOiAocm93Ll9maXJzdE5hbWUgfHwgJycpICsgJyAnICsgKHJvdy5fbGFzdE5hbWUgfHwgJycpLFxuICAgICAgZW1haWw6IHJvdy5fZW1haWwsXG4gICAgICByb2xlX2lkOiByb3cuX3JvbGVSb3dJRCxcbiAgICAgIHJvbGVfcmVzb3VyY2VfaWQ6IHJvdy5fcm9sZUlELFxuICAgICAgc3RhdHVzOiByb3cuc3RhdHVzLFxuICAgICAgY3JlYXRlZF9hdDogcm93Ll9jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkX2F0OiByb3cuX3VwZGF0ZWRBdCxcbiAgICAgIGRlbGV0ZWRfYXQ6IHJvdy5fZGVsZXRlZEF0XG4gICAgfTtcbiAgfVxufVxuIl19